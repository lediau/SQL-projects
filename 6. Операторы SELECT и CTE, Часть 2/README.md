# Задание №6

Банда негодяев собирается ограбить Лас Вегас. Бухгалтер Вонн, Грабитель Альфонс Манада, Вор Бриньольф, Математик Микки Роса и Юрист Кевин Ломакс обсуждают различные варианты того, как добраться до сокровищ Вегаса.

## Задание 1 (4 балла)
-Я и предлагаю - вещал Альфонс Манада - надо просто взять, да и ограбить самого богатого однорукого бандита. Тихонько припугнём его отвёрткой, достанем фишки, обменяем на пиастры и уедем из Вегаса, пока нас не поймали. Если развинтим всего один автомат, должны успеть сбежать из города до того, как владеющая казино мафия узнает о том, что их кто-то обхитрил.

-И как же ты узнаешь, какой автомат самый богатый? - скептически отозвался Бриньольф.

-О, в этом нам поможет Вонн. Этот перебежчик работает в компании, которая занимается перевозкой, установкой и демонтажем оборудования. Их услугами пользуются, когда решают отключить автомат и перевезти из одного казино в другое - а происходит такое частенько. У него есть этот... бункер, в котором хранится информация о том, когда и какой автомат откуда и куда перевозили, да что с ним там на месте делали.

-Не бункер, Альфонс, а база. База данных - поправил его бухгалтер - но да, помочь с этим я могу.

-Во-во, она самая. Как вы знаете, обычный автомат зарабатывает соразмерно тому, сколько звёзд у казино. В казино с рангом 5 звёзд автомат за час зарабатывает столько, сколько автомат в казино с рангом в одну звезду зарабатывает за пять часов. Мы знаем, сколько заработал бы каждый из автоматов за час, стоя в однозвёздочном казино - это называется рейтинг заработка, посмотрите в бункере данных. Мы знаем все передвижения автоматов. Нас не интересуют те, в передвижениях которых мы не уверены, то есть те, у которых пропущена какая-либо из стадий перевозки, установки и демонтажа. Такие автоматы есть, и записи о части их передвижений просто забыли добавить - мы такие автоматы игнорируем. Среди остальных мы ищем тот автомат, который заработал больше всего.

-Откуда же мы знаем, что автомат не вскрыли и не достали из него фишки при демонтаже, или же что из него не достают фишки каждый день?- удивился Микки Роса.

-Эх ты, математик - рассмеялся Манада - в нашем Вегасе традиция такая - автоматы вскрывают и достают из них фишки только когда они забились - а такого еще не было. Так что это не просто автоматы - это почти сейфы! Поэтому и фишки во всех казино одинаковые. А теперь за работу!

Задание: По базе

`create table Casinos(
    id int PRIMARY KEY,
    name text, -- name of the casino
    stars int -- count of stars, from 1 to 5
);

create table SlotMachines(
    id int PRIMARY KEY,
    earning_rate float -- how many chips does a slot machine earn per hour
);

create table SlotMachinesOrders(
    id int PRIMARY KEY,
    event_date timestamp, -- date of event
    event_type text, -- event, one of the ('installation', 'launch', 'dismantling', 'loading', 'on the way', 'acceptance')
    slot_machine_id int REFERENCES SlotMachines, -- id of slot machine
    casino_id int REFERENCES Casinos -- id of casino
);`
найдите игровые автоматы, о передвижениях которых известно, а затем посчитайте, какой из них содержит наибольшую сумму в фишках. Учитывайте следующее:

Статусы автомата меняются только следующим образом: installation →
 launch →
 dismantling →
 loading →
 on the way →
 acceptance →
 installation, и так по кругу. Игровые автоматы с нарушенным циклом следует игнорировать;

Первый статус у каждого автомата в базе - installation;

Для записей event='on the way' поле casino_id равно null;

Для автоматов, у которых последний статус launch следует считать, что они закончили работу сегодня - 2022-11-03.

## Задание 2 (3 балла)
-Авантюрист ты конечно, Альфонс - лениво декларировал Бриньольф - у меня вот другой план. Приходим в казино, наблюдаем за покером. Смотрим, кто и сколько поставил, записываем в тетрадку. Если кто-то выиграл, тоже записываем. Когда казино закрывается, встречаемся в толпе с самым заработавшим игроком, подцепляем его выигранные купюры из кармана и незаметно для него становимся богаче, да ещё и с казино не конфликтуем. Вот это план надёжный - явно лучше, чем пытаться раскрутить автомат.

Задание: По базе

`create table PokerEvent(
    id int PRIMARY KEY,
    event_type text, -- type of event - win or bet
    executor text -- name of the player
);

create table Bets(
    id int PRIMARY KEY,
    poker_event_id int REFERENCES PokerEvent, -- id of event
    value int -- size of the bet
);`
определите человека, который к концу игры оказался богаче всех, а также выведите его состояние. Учитывайте следующее:

Все игроки начали игру с 1000 фишками;

Все действия происходят в порядке возрастания PokerEvent.id;

Все записи в таблице валидные - никто не сделал ставку, когда у него не было денег.

## Задание 3 (2 балла)
-Вы, Сэры, преступники, а сидеть Вам следует не в казино, а в тюрьме - заявил Микки Роса - я предлагаю заработать честным образом. Садимся у стола, где играют в BlackJack, а дальше просто записываем, какие карты выходят из игры. Увеличиваем или уменьшаем счёт, находим максимальное значение, достигнутой за день, а уже после этого приходим в казино и спокойно заходим каждый раз, когда счёт доходит до обнаруженного нами максимального значения.

-Счёт? О чём ты, Микки?

-Джентельмены, в этой игре выгодно ставить, когда из колоды убраны определённые карты. Для этого математики придумали стратегию, по которой каждая вышедшая из колоды карта изменяет значение счётчика. Сколько каждая карта добавляет или убавляет от текущего значения, которое начинается с нуля в начале игрового дня, я вам расскажу позже. В нашем Лас Вегасе играют по-честному, а потому колоду не меняют, пока в ней ещё есть карты. Для игры используют одну обычную колоду карт.

Задание: По таблице:

`create table TwentyOneTables (
 id int,
 table_n int, -- table number
 card varchar(2) -- type of card: like ♥4 or ♠J
);`
Найдите максимальное значение счётчика за шесть игр. В этой задаче считается, что атрибут с номером стола означает номер игры. В начале каждой игры счётчик обнуляется.

Изменение счётчика:

Валет, Дама, Король и Туз уменьшают счётчик на 1

3, 4, 6 увеличивают счётчик на 1

5 увеличивает счётчик на 1.5

9 уменьшает счётчик на 0.5

10 (то есть 0) уменьшает счетчик на 1

2 и 7 увеличивают счётчик на 0.5

8 не изменяет значение счётчика

## Задание 4 (1 балл)
-Что-то не верится мне в честность казино- скептически заявил Кевин- пожалуй, следует проверить, действительно ли в этом вашем казино используют обычные колоды карт. Я понаблюдаю за играми на шести разных столах- уж где-то они наверняка используют нестандартную колоду.

Задание: По таблице:

`create table TwentyOneTables (
 id int,
 table_n int, -- table number
 card varchar(2) -- type of card: like ♥4 or ♠J
);`
Найдите стол, за которым используют колоду с набором карт, отличным от стандартного.
